{
  "hash": "4f822bec72f3f83c22bca18d7c49dfa2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Preregistration: Evaluation of Clinical Benefit\"\nauthor: \"Gaylen Fronk\"\ndate: \"2024-03-29\"\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nparams:\n  study: \"match\"\n  version: \"v5\"\n  algorithms: \"all\"   # \"all\" or name of specific algorithm\n  y_col_name: \"pp_hybrid_wk4_outcome\" \nformat:\n  html:\n    embed-resources: true\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\nstudy <- params$study\nversion <- params$version\nalgorithms <- params$algorithms\ny_col_name <- params$y_col_name\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\n# packages for script\nlibrary(lme4)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoading required package: Matrix\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(tidymodels)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n✔ broom        1.0.5     ✔ recipes      1.0.9\n✔ dials        1.2.0     ✔ rsample      1.2.0\n✔ dplyr        1.1.4     ✔ tibble       3.2.1\n✔ ggplot2      3.4.4     ✔ tidyr        1.3.1\n✔ infer        1.0.6     ✔ tune         1.1.2\n✔ modeldata    1.3.0     ✔ workflows    1.1.3\n✔ parsnip      1.1.1     ✔ workflowsets 1.0.1\n✔ purrr        1.0.2     ✔ yardstick    1.3.0\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ purrr::discard()  masks scales::discard()\n✖ tidyr::expand()   masks Matrix::expand()\n✖ dplyr::filter()   masks stats::filter()\n✖ dplyr::lag()      masks stats::lag()\n✖ tidyr::pack()     masks Matrix::pack()\n✖ recipes::step()   masks stats::step()\n✖ tidyr::unpack()   masks Matrix::unpack()\n✖ recipes::update() masks Matrix::update(), stats::update()\n• Dig deeper into tidy modeling with R at https://www.tmwr.org\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ forcats   1.0.0     ✔ readr     2.1.5\n✔ lubridate 1.9.3     ✔ stringr   1.5.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ readr::col_factor() masks scales::col_factor()\n✖ purrr::discard()    masks scales::discard()\n✖ tidyr::expand()     masks Matrix::expand()\n✖ dplyr::filter()     masks stats::filter()\n✖ stringr::fixed()    masks recipes::fixed()\n✖ dplyr::lag()        masks stats::lag()\n✖ tidyr::pack()       masks Matrix::pack()\n✖ readr::spec()       masks yardstick::spec()\n✖ tidyr::unpack()     masks Matrix::unpack()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(blme)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'blme' was built under R version 4.3.3\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(brms)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'brms' was built under R version 4.3.3\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoading required package: Rcpp\n\nAttaching package: 'Rcpp'\n\nThe following object is masked from 'package:rsample':\n\n    populate\n\nLoading 'brms' package (version 2.20.4). Useful instructions\ncan be found by typing help('brms'). A more detailed introduction\nto the package is available through vignette('brms_overview').\n\nAttaching package: 'brms'\n\nThe following object is masked from 'package:dials':\n\n    mixture\n\nThe following object is masked from 'package:lme4':\n\n    ngrps\n\nThe following object is masked from 'package:stats':\n\n    ar\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\nlibrary(parallel)\n\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/fun_eda.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"c045eee2655a18dc85e715b78182f176327358a7\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/chtc/static_files/fun_chtc.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"bb7bddab14e337e74cb65ad3b94d58a2492d34cd\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\ntheme_set(theme_classic()) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n#| echo: false\n\n# handle conflicts\noptions(conflicts.policy = \"depends.ok\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n\n# absolute paths\nswitch (Sys.info()[['sysname']],\n        # PC paths\n        Windows = {\n          path_models <- stringr::str_c(\"P:/studydata/match/models/\", \n                                        y_col_name)},\n        \n        # IOS paths\n        Darwin = {\n          path_models <- stringr::str_c(\"/Volumes/private/studydata/match/models/\", \n                                        y_col_name)},\n        \n        # Linux paths\n        Linux = {\n          path_models <- stringr::str_c(\"~/mnt/private/studydata/match/models/\", \n                                        y_col_name)}\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n\n# chunk defaults\nknitr::opts_chunk$set(attr.output='style=\"max-height: 500px;\"')\n\noptions(tibble.width = Inf)\noptions(tibble.print_max = Inf)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n\n# read in d\nd <- read_csv(file.path(path_models, str_c(\"aim_2_\", version, \".csv\")),\n              show_col_types = FALSE) |> \n  mutate(outcome_rct_wk4_num = if_else(outcome_rct_wk4 == \"abstinent\", 1, 0),\n         outcome_rct_wk12_num = if_else(outcome_rct_wk12 == \"abstinent\", 1, 0),\n         outcome_rct_wk26_num = if_else(outcome_rct_wk26 == \"abstinent\", 1, 0),\n         tx_worst = case_when(\n           prob_patch < prob_combo_nrt & prob_patch < prob_varenicline ~ \"patch\",\n           prob_combo_nrt < prob_patch & prob_combo_nrt < prob_varenicline ~ \"combo_nrt\",\n           prob_varenicline < prob_patch & prob_varenicline < prob_combo_nrt ~ \"varenicline\",\n           TRUE ~ NA_character_),\n         tx_second = case_when(\n           tx_worst == \"patch\" & tx_best == \"varenicline\" ~ \"combo_nrt\",\n           tx_worst == \"patch\" & tx_best == \"combo_nrt\" ~ \"varenicline\",\n           tx_worst == \"varenicline\" & tx_best == \"patch\" ~ \"combo_nrt\",\n           tx_worst == \"varenicline\" & tx_best == \"combo_nrt\" ~ \"patch\",\n           tx_worst == \"combo_nrt\" & tx_best == \"varenicline\" ~ \"patch\",\n           tx_worst == \"combo_nrt\" & tx_best == \"patch\" ~ \"varenicline\",\n           TRUE ~ NA_character_)) |> \n  mutate(tx_rank = case_when(\n    tx_rct == tx_best ~ \"first\",\n    tx_rct == tx_second ~ \"second\",\n    tx_rct == tx_worst ~ \"third\",\n    TRUE ~ NA_character_)) |> \n  select(subid, starts_with(\"tx_\"), starts_with(\"prob_\"),\n         outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num) \n\n# read in best_config\nbest_configuration <- read_csv(file.path(path_models, str_c(\"best_config_\", version, \".csv\")),\n                               show_col_types = FALSE) |> \n  select(algorithm, feature_set, alpha = hp1, lambda = hp2, resample)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n#| eval: false\n\n# make figure for john's presentation\nd_fig <- d |> \n  select(subid, tx_rank, \n         outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num) |> \n  pivot_longer(\n    cols = c(outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num),\n    names_to = \"week\",\n    names_pattern = \"(?<=outcome_rct_)(.+)(?=_num)\",\n    values_to = \"outcome_rct_num\"\n  ) |> \n  mutate(tx_rank = factor(tx_rank, \n                          levels = c(\"first\", \"second\", \"third\")),\n         week = factor(week,\n                       levels = c(\"wk4\", \"wk12\", \"wk26\")),\n         subid = factor(subid)) |> \n  summarize(outcome_mean = mean(outcome_rct_num), .by = c(tx_rank, week)) \n\n# bar chart\nd_fig |> \n  ggplot(aes(x = week, y = outcome_mean, fill = tx_rank)) +\n  geom_col(position = \"dodge\") \n\n# line graph\nd_fig |> \n  ggplot(aes(x = week, y = outcome_mean, color = tx_rank)) +\n  geom_line(aes(group = tx_rank)) +\n  geom_point() +\n  scale_y_continuous(limits = c(0, 0.5))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n\n# functions for viewing & understanding allFit() results\n# originally created in fun_stressor_use.R, modified slightly to work here\ntidy_opts <- function(m, terms = c(\"tx_rankbest_v_other\", \n                                   \"tx_ranksecond_v_third\",\n                                   \"tx_rankbest_v_other:weekwk4_v_later\", \n                                   \"tx_rankbest_v_other:weekwk12_v_wk26\")) {\n\n  s <- summary(m)\n  \n  # Remove optimizers that fail to be fit at all (this is not models that don't converge)\n  m <- m[which(s$which.OK)]\n  \n  effects <- m %>% \n    map_dfr(broom.mixed::tidy) %>% \n    filter(term %in% terms) %>% \n    arrange(term) %>% \n    mutate(optimizer = rep(names(m), length(terms))) %>% \n    select(-group) %>% \n    relocate(optimizer) %>% \n    arrange(term, optimizer)\n  \n  all <- tibble(optimizer = names(s$msgs), term = \"model\", msg = s$msgs, llik = s$llik) %>% \n    bind_rows(effects)\n  return(all)\n}\n\nextract_opts_msgs <- function(tidy_msg, opt_name){\n\n  if (opt_name != \"\") {\n    if (is.null(tidy_msg)) {\n      the_msg <- \"\"\n    } else {\n      the_msg <- unlist(tidy_msg)\n    }\n    msgs <- tibble(opt_name = opt_name, \n                   msg = the_msg)\n  } else{\n    msgs <- tibble(opt_name = character(), msg = character())\n  }\n\n\n  return(msgs)\n}\n```\n:::\n\n\n## Study Overview\n\n### Specific Aims\n\nThis project represents a tangible application of the precision mental health paradigm using modern machine learning approaches. This project aims to produce a decision-making tool to select among cigarette smoking cessation treatments for individuals looking to quit smoking. \n\nCigarette smoking remains a critical and costly public health crisis. Existing treatments are only modestly effective at best. Additionally, treatments are similarly effective at the population level, meaning that even population-level effectiveness cannot guide treatment selection for individuals quitting smoking. Thus, deciding among first-line (i.e., FDA-approved) smoking cessation medications is a specific, objective decision that many individuals who smoke (or their providers) must make. Successful application of the precision mental health paradigm to cigarette smoking cessation would have immediate clinical benefit. \n\nSpecifically, this project pursues the following aims:\n\n**AIM 1: Build a machine learning model to guide treatment selection for cigarette smoking cessation.** We will build a machine learning model to predict treatment success (i.e., 4-week point-prevalence abstinence from smoking) for people who smoke who received one of three cigarette smoking cessation treatments. This model will use clinical features (predictors) from a richly characterized sample of people who smoke from a previously completed randomized controlled trial. The model will produce probabilities of treatment success for each treatment such that it can guide selection of the best treatment for any specific individual.\n\n**AIM 2: Evaluate the clinical benefit of using a treatment selection machine learning model.** Using the best model identified in **AIM 1**, we will identify the treatment for each person that gives them the highest likelihood of abstinence at 4 weeks by comparing predicted probabilities of abstinence for each participant for each treatment. We will then evaluate the clinical benefit of this model-based treatment selection approach. \n\n### Study Progress\n\nThis project relies on existing data from a completed comparative effectiveness trial by [Baker et al., 2016](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4824537/). Briefly, 1086 individuals who smoke cigarettes were randomized to receive varenicline, combination nicotine replacement therapy (NRT), or nicotine patch to assist with a quit attempt. Individuals were richly characterized at baseline (pre-treatment) with respect to demographic characteristics, mental health, social/environmental variables, physical health, and smoking history. Participants were assessed periodically for biologically confirmed, 7-day point-prevalence abstinence. When abstinence was biologically confirmed (i.e., via exhaled carbon monoxide), individuals were labeled as abstinent; otherwise, individuals were labeled as smoking.\n\n**AIM 1** analyses have been completed: Models using all available data have been fit and selected with nested cross-validation (1 repeat of 10-fold cross-validation in the inner loops, 3 repeats of 10-fold cross-validation in the outer loop). These 30-held out folds (\"test sets\") were used to evaluate model performance. A single, best model was selected with 1 repeat of 10-fold cross-validation in the full dataset. The best model configuration includes the following:\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nglimpse(best_configuration)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 1\nColumns: 5\n$ algorithm   <chr> \"glmnet\"\n$ feature_set <chr> \"item_ordinal\"\n$ alpha       <dbl> 0.1\n$ lambda      <dbl> 0.1326421\n$ resample    <chr> \"up_1\"\n```\n\n\n:::\n:::\n\n\n* Selected algorithm was glmnet (xgboost and random forest also considered)\n\n* Selected feature set was \"item_ordinal\" indicating that individual items (rather than scale scores) were used, and ordinal scoring was used for ordered data (rather than dummy coding)\n\n* Selected resampling approach was \"up_1\" corresponding to upsampling (vs. downsampling or SMOTE) with a ratio of 1:1 (majority:minority class)\n\n* Values of the hyperparameters alpha and lambda were selected from sensible ranges for each value\n\n**AIM 2** analyses using this full model are underway. Specifically:\n\nWe have used the full model to generate three predictions (probabilities, `prob_*`) for each participant by substituting each treatment into the model inputs. Thus, there is one prediction per person per treatment. \n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nset.seed(82294)\nd |> \n  select(subid, prob_patch, prob_combo_nrt, prob_varenicline) |> \n  slice_sample(n = 10) |> \n  print_kbl(digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; \"><table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> subid </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> prob_patch </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> prob_combo_nrt </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> prob_varenicline </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 40244 </td>\n   <td style=\"text-align:right;\"> 0.430 </td>\n   <td style=\"text-align:right;\"> 0.531 </td>\n   <td style=\"text-align:right;\"> 0.570 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51235 </td>\n   <td style=\"text-align:right;\"> 0.189 </td>\n   <td style=\"text-align:right;\"> 0.198 </td>\n   <td style=\"text-align:right;\"> 0.159 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50478 </td>\n   <td style=\"text-align:right;\"> 0.436 </td>\n   <td style=\"text-align:right;\"> 0.319 </td>\n   <td style=\"text-align:right;\"> 0.403 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 40482 </td>\n   <td style=\"text-align:right;\"> 0.247 </td>\n   <td style=\"text-align:right;\"> 0.222 </td>\n   <td style=\"text-align:right;\"> 0.257 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30048 </td>\n   <td style=\"text-align:right;\"> 0.583 </td>\n   <td style=\"text-align:right;\"> 0.542 </td>\n   <td style=\"text-align:right;\"> 0.561 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30294 </td>\n   <td style=\"text-align:right;\"> 0.339 </td>\n   <td style=\"text-align:right;\"> 0.315 </td>\n   <td style=\"text-align:right;\"> 0.340 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 31221 </td>\n   <td style=\"text-align:right;\"> 0.192 </td>\n   <td style=\"text-align:right;\"> 0.153 </td>\n   <td style=\"text-align:right;\"> 0.217 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50676 </td>\n   <td style=\"text-align:right;\"> 0.148 </td>\n   <td style=\"text-align:right;\"> 0.169 </td>\n   <td style=\"text-align:right;\"> 0.140 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50666 </td>\n   <td style=\"text-align:right;\"> 0.159 </td>\n   <td style=\"text-align:right;\"> 0.185 </td>\n   <td style=\"text-align:right;\"> 0.189 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50224 </td>\n   <td style=\"text-align:right;\"> 0.193 </td>\n   <td style=\"text-align:right;\"> 0.165 </td>\n   <td style=\"text-align:right;\"> 0.207 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\nThe treatment that yields the highest model-predicted probability of abstinence is identified as that participant's \"best\" treatment (`tx_best`). \n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd |> \n  select(subid, tx_best, prob_patch, prob_combo_nrt, prob_varenicline) |> \n  slice_sample(n = 10) |> \n  print_kbl(digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; \"><table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> subid </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> tx_best </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> prob_patch </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> prob_combo_nrt </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> prob_varenicline </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 50422 </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> 0.344 </td>\n   <td style=\"text-align:right;\"> 0.352 </td>\n   <td style=\"text-align:right;\"> 0.246 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30984 </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> 0.195 </td>\n   <td style=\"text-align:right;\"> 0.227 </td>\n   <td style=\"text-align:right;\"> 0.197 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50295 </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> 0.455 </td>\n   <td style=\"text-align:right;\"> 0.431 </td>\n   <td style=\"text-align:right;\"> 0.437 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 20769 </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> 0.450 </td>\n   <td style=\"text-align:right;\"> 0.516 </td>\n   <td style=\"text-align:right;\"> 0.569 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51261 </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> 0.357 </td>\n   <td style=\"text-align:right;\"> 0.340 </td>\n   <td style=\"text-align:right;\"> 0.305 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30149 </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> 0.443 </td>\n   <td style=\"text-align:right;\"> 0.465 </td>\n   <td style=\"text-align:right;\"> 0.341 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 40645 </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> 0.358 </td>\n   <td style=\"text-align:right;\"> 0.325 </td>\n   <td style=\"text-align:right;\"> 0.441 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 20015 </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> 0.418 </td>\n   <td style=\"text-align:right;\"> 0.464 </td>\n   <td style=\"text-align:right;\"> 0.485 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 40126 </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> 0.284 </td>\n   <td style=\"text-align:right;\"> 0.403 </td>\n   <td style=\"text-align:right;\"> 0.381 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51165 </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> 0.103 </td>\n   <td style=\"text-align:right;\"> 0.074 </td>\n   <td style=\"text-align:right;\"> 0.137 </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\nThe best treatments spanned all three medication options: varenicline, combination nicotine replacement therapy (\"combo_nrt\"), and nicotine patch (\"patch\").\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd |> \n  tab(tx_best)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 3 × 3\n  tx_best         n  prop\n  <chr>       <int> <dbl>\n1 combo_nrt     339 0.312\n2 patch         193 0.178\n3 varenicline   554 0.510\n```\n\n\n:::\n:::\n\n\nSome participants' best treatment (`tx_best`) matched what they were randomly assigned in the original trial (`tx_rct`). Other participants may have received what the model identified as their second-best or worst treatment. Thus, participants' original treatment can be \"ranked\" as being their first-best, second-best, or third-best (worst) model-selected treatment.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd |> \n  select(subid, tx_rank, tx_rct, tx_best, tx_second, tx_worst) |> \n  slice_sample(n = 10) |> \n  print_kbl()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; \"><table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> subid </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> tx_rank </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> tx_rct </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> tx_best </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> tx_second </th>\n   <th style=\"text-align:right;position: sticky; top:0; background-color: #FFFFFF;\"> tx_worst </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 30705 </td>\n   <td style=\"text-align:right;\"> third </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30179 </td>\n   <td style=\"text-align:right;\"> first </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51390 </td>\n   <td style=\"text-align:right;\"> first </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51817 </td>\n   <td style=\"text-align:right;\"> third </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50140 </td>\n   <td style=\"text-align:right;\"> second </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 20359 </td>\n   <td style=\"text-align:right;\"> second </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51680 </td>\n   <td style=\"text-align:right;\"> second </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51148 </td>\n   <td style=\"text-align:right;\"> third </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 30099 </td>\n   <td style=\"text-align:right;\"> second </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50844 </td>\n   <td style=\"text-align:right;\"> third </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n   <td style=\"text-align:right;\"> patch </td>\n   <td style=\"text-align:right;\"> varenicline </td>\n   <td style=\"text-align:right;\"> combo_nrt </td>\n  </tr>\n</tbody>\n</table></div>\n\n`````\n:::\n:::\n\n\nTreatment \"ranks\" were distributed somewhat evenly across first-, second-, and third-best treatments.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd |> \n  tab(tx_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 3 × 3\n  tx_rank     n  prop\n  <chr>   <int> <dbl>\n1 first     409 0.377\n2 second    322 0.297\n3 third     355 0.327\n```\n\n\n:::\n:::\n\n\n### Purpose of Preregistration\n\nThe purpose of this document is to **preregister the analyses for evaluating the clinical benefit of this treatment selection model**. \n\nOur primary analysis will compare the observed outcomes (i.e., abstinence vs. smoking, from the original trial) for people who received their first-, second-, or third-best treatments. We will examine these outcomes over the following time points:\n\n* 4 weeks: This was the time point that served as the outcome for the prediction model. This selection was made so that, in real-world implementation, treatment could be adjusted earlier for individuals for whom treatment is not working.\n\n* 12 weeks: This is end-of-treatment and represents a mid-point between the early (4-week) outcome and the later outcome.\n\n* 26 weeks (6 months): This is the gold standard assessment period for smoking cessation treatments and was the primary outcome for the original trial ([Baker et al., 2016](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4824537/)). This duration is often used as a proxy for long-term success.\n\nThus, our model will have the following components:\n\n1. Dependent variable: abstinence (vs. smoking; `outcome_rct_num`). Binary outcome with abstinence coded as 1 and smoking coded as 0.\n\n2. Independent variable: treatment rank (`tx_rank`). Between-subjects categorical variable with three levels (first, second, third). This variable will be coded with orthogonal Helmert contrasts such that we compare individuals who received their first-best treatment to all others, and individuals who received their second-best treatment to individuals who received their third-best treatment.\n\n3. Independent variable: time (`week`). Within-subjects categorical variable with three levels (week 4, week 12, week 26). This variable will be coded with orthogonal Helmert contrasts to avoid making an assumption about the linearity of this effect. We will compare the earliest 4-week outcome to the two later outcomes, and the 12-week outcome to the 26-week (6 month) outcome. \n\n4. Interaction between treatment rank and time\n\n5. Random slope for time (3 repeated observations of time for each subject)\n\n6. Random intercept\n\nWe plan to follow a mixed-effects modeling approach using the `lme4` package. Specifically, we will fit a generalized linear model using `glmer()` with the components listed above. \n\nOur **focal effect** is the main effect of the treatment rank Helmert contrast comparing individuals who received their best treatment to all others (i.e., across all times). We predict that individuals who received their best treatment will have improved outcomes compared to individuals who did not. \n\nOur **secondary effects** include: \n\n* The main effect of the treatment rank Helmert contrast comparing individuals who received their second-best treatment to individuals who received their worst treatment (i.e., across all times). We predict that individuals who received their second-best treatment will have improved outcomes compared to individuals who did not.\n\n* The interactions between the best vs. other treatment rank contrast and both time contrasts (week 4 vs. later, week 12 vs. week 26). We do not have directional hypotheses about these interactions.\n\n  + If either of these interactions are significant (*p* < 0.05), we will conduct **follow-up tests** of the simple effect of the best vs. other treatment contrast at all 3 time points (week 4, week 12, and week 26).\n\nAlthough the above estimates comprise our focal effects, we plan to report the estimates, test statistics, *p*-values, and confidence intervals for all fixed effects from this model.\n\n## Shuffle Data\n\nTo ensure that all proposed analyses are feasible and to specify analyses as precisely as possible, the remainder of this document conducts analyses using our data with shuffled outcome variables. Following preregistration, our analyses will follow this script exactly using our real data.\n\nTo create this shuffled dataset, we:\n\n* sample without replacement for 3 outcomes (outcome distribution remains the same at each time point; link with model-based treatment assignment is severed)\n\n* pivot into long format with week as a within-subjects factor\n\n* remove unnecessary variables\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nset.seed(72905)\nd_shuf <- d |> \n  select(subid, tx_rank, \n         outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num) |> \n  mutate(outcome_rct_wk4_num = sample(d$outcome_rct_wk4_num, \n                                      nrow(d), replace = FALSE),\n         outcome_rct_wk12_num = sample(d$outcome_rct_wk12_num, \n                                       nrow(d), replace = FALSE),\n         outcome_rct_wk26_num = sample(d$outcome_rct_wk26_num, \n                                       nrow(d), replace = FALSE)) |> \n  pivot_longer(\n    cols = c(outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num),\n    names_to = \"week\",\n    names_pattern = \"(?<=outcome_rct_)(.+)(?=_num)\",\n    values_to = \"outcome_rct_num\"\n  ) |> \n  mutate(tx_rank = factor(tx_rank, \n                          levels = c(\"third\", \"second\", \"first\")),\n         week = factor(week,\n                       levels = c(\"wk26\", \"wk12\", \"wk4\")),\n         subid = factor(subid)) \n\nglimpse(d_shuf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nRows: 3,258\nColumns: 4\n$ subid           <fct> 20010, 20010, 20010, 20015, 20015, 20015, 20030, 20030…\n$ tx_rank         <fct> second, second, second, second, second, second, third,…\n$ week            <fct> wk4, wk12, wk26, wk4, wk12, wk26, wk4, wk12, wk26, wk4…\n$ outcome_rct_num <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, …\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nrm(d)\n```\n:::\n\n\nConfirm that data look random\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_shuf |> \n  group_by(tx_rank) |> \n  summarize(mean_outcome = mean(outcome_rct_num)) |> \n  arrange(desc(tx_rank))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n# A tibble: 3 × 2\n  tx_rank mean_outcome\n  <fct>          <dbl>\n1 first          0.289\n2 second         0.292\n3 third          0.298\n```\n\n\n:::\n:::\n\n\nSet contrasts for week and treatment rank\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# contrast coding on week\nc_week <- contr.helmert(c(\"wk26\", \"wk12\", \"wk4\"))\nc_week[, 1] <- c_week[, 1] / (max(c_week[, 1]) - min(c_week[, 1]))\nc_week[, 2] <- c_week[, 2] / (max(c_week[, 2]) - min(c_week[, 2]))\ncolnames(c_week) <- c(\"wk12_v_wk26\", \"wk4_v_later\")\ncontrasts(d_shuf$week) <- c_week\ncontrasts(d_shuf$week)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n     wk12_v_wk26 wk4_v_later\nwk26        -0.5  -0.3333333\nwk12         0.5  -0.3333333\nwk4          0.0   0.6666667\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# contrast coding on treatment rank\nc_tx <- contr.helmert(c(\"third\", \"second\", \"first\"))\nc_tx[, 1] <- c_tx[, 1] / (max(c_tx[, 1]) - min(c_tx[, 1]))\nc_tx[, 2] <- c_tx[, 2] / (max(c_tx[, 2]) - min(c_tx[, 2]))\ncolnames(c_tx) <- c(\"second_v_third\", \"best_v_other\")\ncontrasts(d_shuf$tx_rank) <- c_tx\ncontrasts(d_shuf$tx_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n       second_v_third best_v_other\nthird            -0.5   -0.3333333\nsecond            0.5   -0.3333333\nfirst             0.0    0.6666667\n```\n\n\n:::\n:::\n\n\n## Analysis Steps\n\n### Primary Model\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_1 <- lme4::glmer(outcome_rct_num ~ tx_rank * week + (1 + week | subid),\n                       data = d_shuf,\n                       family = binomial(link = \"logit\"),\n                       control = glmerControl(optimizer = \"bobyqa\",\n                                              optCtrl = list(maxfun = 3e6)))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nboundary (singular) fit: see help('isSingular')\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nsummary(model_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: binomial  ( logit )\nFormula: outcome_rct_num ~ tx_rank * week + (1 + week | subid)\n   Data: d_shuf\nControl: glmerControl(optimizer = \"bobyqa\", optCtrl = list(maxfun = 3e+06))\n\n     AIC      BIC   logLik deviance df.resid \n  3936.7   4028.1  -1953.4   3906.7     3243 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-0.7524 -0.6477 -0.5594  1.3170  1.9633 \n\nRandom effects:\n Groups Name            Variance Std.Dev. Corr       \n subid  (Intercept)     0.01418  0.1191              \n        weekwk12_v_wk26 0.62714  0.7919   -1.00      \n        weekwk4_v_later 0.19735  0.4442    1.00 -1.00\nNumber of obs: 3258, groups:  subid, 1086\n\nFixed effects:\n                                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                           -0.92412    0.04446 -20.787  < 2e-16 ***\ntx_ranksecond_v_third                 -0.03657    0.10053  -0.364 0.716024    \ntx_rankbest_v_other                   -0.02519    0.08207  -0.307 0.758873    \nweekwk12_v_wk26                        0.23731    0.12565   1.889 0.058928 .  \nweekwk4_v_later                        0.35814    0.09350   3.830 0.000128 ***\ntx_ranksecond_v_third:weekwk12_v_wk26  0.20403    0.25753   0.792 0.428201    \ntx_rankbest_v_other:weekwk12_v_wk26   -0.43168    0.21062  -2.050 0.040402 *  \ntx_ranksecond_v_third:weekwk4_v_later  0.09957    0.21046   0.473 0.636144    \ntx_rankbest_v_other:weekwk4_v_later    0.09871    0.17130   0.576 0.564465    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n                 (Intr) tx_rnks__ tx_rnkb__ w12__2 wkw4__ tx_rnks__:12__26\ntx_rnkscn__       0.049                                                   \ntx_rnkbst__      -0.077 -0.039                                            \nwkwk12_v_26      -0.080 -0.028     0.062                                  \nwkwk4_v_ltr      -0.121 -0.016    -0.004     0.047                        \ntx_rnks__:12__26 -0.026 -0.088     0.016     0.055  0.018                 \ntx_rnkb__:12__26  0.054  0.015    -0.038    -0.061 -0.036 -0.042          \ntx_rnks__:4__    -0.014 -0.046     0.009     0.018  0.041  0.009          \ntx_rnkb__:4__    -0.004  0.009    -0.054    -0.041 -0.084 -0.010          \n                 tx_rnkb__:12__26 tx_rnks__:4__\ntx_rnkscn__                                    \ntx_rnkbst__                                    \nwkwk12_v_26                                    \nwkwk4_v_ltr                                    \ntx_rnks__:12__26                               \ntx_rnkb__:12__26                               \ntx_rnks__:4__    -0.009                        \ntx_rnkb__:4__    -0.026           -0.033       \noptimizer (bobyqa) convergence code: 0 (OK)\nboundary (singular) fit: see help('isSingular')\n```\n\n\n:::\n:::\n\n\n### Alternative Models for Robustness Checks\n\nThe model fit above has a singular fit. There are a number of recommended approaches to address singular fits (see `?isSingular`) if the model fit with our real data also has a singular fit. \n\nFor consistency, the following proposed alternative approaches mirror the steps we followed in a previously published project from our laboratory that also required complex mixed-effects modeling ([Schultz et al., 2022](https://psycnet.apa.org/record/2022-10249-001)). These steps are available in our open-access, annotated analysis scripts (e.g., [this script](https://osf.io/k8gfc)). \n\n1. Use a partially Bayesian method that uses regularizing priors to force the estimated random effects variance-covariance matrices away from singularity ([Chung et al., 2013](https://link.springer.com/article/10.1007/s11336-013-9328-2), `blme` package). We would use the `\"nlminbwrap\"` optimizer because `\"bobyqa\"` produced a singular fit.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| eval: false\nmodel_2 <- blme::bglmer(outcome_rct_num ~ tx_rank * week + (1 + week | subid),\n                        data = d_shuf,\n                        family = binomial(link = \"logit\"),\n                        control = glmerControl(optimizer = \"nlminbwrap\",\n                                               optCtrl = list(maxfun = 3e6)))\n```\n:::\n\n\n2. Use a simpler random effects structure to address problems with singular fits. Following this strategy, we would fit a model with only the random intercept.\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| eval: false\nmodel_3 <- lme4::glmer(outcome_rct_num ~ tx_rank * week + (1 | subid),\n                       data = d_shuf,\n                       family = binomial(link = \"logit\"),\n                       control = glmerControl(optimizer = \"bobyqa\",\n                                              optCtrl = list(maxfun = 3e6)))\n```\n:::\n\n\n3. Re-fit the glmer model with the full random effects structure across all available optimizers and review for consistency of log-likelihood ratios, fixed effects, and test statistics of focal effect across optimizers. \n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| eval: false\nopts <- tibble(optimizer = c(\"bobyqa\", \"Nelder_Mead\", \"nlminbwrap\", \n                             \"nmkbw\", \"optimx\", \"nloptwrap\", \"nloptwrap\"),\n               method = c(\"\", \"\", \"\", \"\", \"L-BFGS-B\", \n                          \"NLOPT_LN_NELDERMEAD\", \"NLOPT_LN_BOBYQA\")) %>% \n  as.data.frame()\n\nmodel_all <- allFit(model_1, verbose = FALSE, meth.tab = opts)\n```\n:::\n\n::: {.cell .hidden}\n\n```{.r .cell-code .hidden}\n#| include: false\n#| eval: false\n\n# Review warning/error messages across remaining optimizers\neffects <- tidy_opts(model_all, terms = \"tx_rankbest_v_other\")\nopt_names <- names(effects$msg)\neffects$msg |> \n  map2_dfr(opt_names, extract_opts_msgs)\n\n# confirm that log-likelihood ratios are equivalent across optimizers\neffects |> \n  filter(term == \"model\") |> \n  select(optimizer, llik)\n\n# Confirm fixed effects & test stats are equivalent across optimizers for our focal effect (best treatment vs. other)\neffects |> \n  filter(term == \"tx_rankbest_v_other\") |> \n  select(-msg, -llik)\n```\n:::\n\n\n### Follow-up analyses: Simple Effects\n\nIf either interaction for our secondary outcomes (best vs. other treatment rank contrast X both time contrasts) is significant (*p* < 0.05), we will conduct follow-up analyses to test the simple effect of the best vs. other treatment rank contrast at each time point.\n\nSimple effect at 4 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_4_shuf <- d_shuf |> \n  filter(week == \"wk4\")\n\nmodel_4wk <- glm(outcome_rct_num ~ tx_rank, \n                 data = d_4_shuf,\n                 family = binomial(link = \"logit\"))\n\nsummary(model_4wk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n\nCall:\nglm(formula = outcome_rct_num ~ tx_rank, family = binomial(link = \"logit\"), \n    data = d_4_shuf)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -0.65741    0.06432 -10.221   <2e-16 ***\ntx_ranksecond_v_third  0.02860    0.16263   0.176    0.860    \ntx_rankbest_v_other    0.03899    0.13191   0.296    0.768    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1394.7  on 1085  degrees of freedom\nResidual deviance: 1394.5  on 1083  degrees of freedom\nAIC: 1400.5\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\nSimple effect at 12 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_12_shuf <- d_shuf |> \n  filter(week == \"wk12\")\n\nmodel_12wk <- glm(outcome_rct_num ~ tx_rank, \n                  data = d_12_shuf,\n                  family = binomial(link = \"logit\"))\n\nsummary(model_12wk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n\nCall:\nglm(formula = outcome_rct_num ~ tx_rank, family = binomial(link = \"logit\"), \n    data = d_12_shuf)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -0.88670    0.06706 -13.222   <2e-16 ***\ntx_ranksecond_v_third  0.03094    0.16633   0.186   0.8524    \ntx_rankbest_v_other   -0.26455    0.14046  -1.883   0.0596 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1308.0  on 1085  degrees of freedom\nResidual deviance: 1304.4  on 1083  degrees of freedom\nAIC: 1310.4\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\nSimple effect at 26 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_26_shuf <- d_shuf |> \n  filter(week == \"wk26\")\n\nmodel_26wk <- glm(outcome_rct_num ~ tx_rank, \n                  data = d_26_shuf,\n                  family = binomial(link = \"logit\"))\n\nsummary(model_26wk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```{style=\"max-height: 500px;\"}\n\nCall:\nglm(formula = outcome_rct_num ~ tx_rank, family = binomial(link = \"logit\"), \n    data = d_26_shuf)\n\nCoefficients:\n                      Estimate Std. Error z value Pr(>|z|)    \n(Intercept)           -1.12754    0.07122 -15.833   <2e-16 ***\ntx_ranksecond_v_third -0.16791    0.18183  -0.923    0.356    \ntx_rankbest_v_other    0.15384    0.14439   1.065    0.287    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1213.6  on 1085  degrees of freedom\nResidual deviance: 1211.7  on 1083  degrees of freedom\nAIC: 1217.7\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}