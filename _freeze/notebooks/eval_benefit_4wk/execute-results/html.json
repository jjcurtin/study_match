{
  "hash": "b54a167dfbcabdfab665cd9e40eb7246",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Evaluation of Clinical Benefit: Week 4 Model\"\nauthor: \"Gaylen Fronk\"\ndate: \"2024-07-11\"\nnumber-sections: true\noutput: \n  html_document:\n    toc: true \n    toc_depth: 4\nformat:\n  html:\n    embed-resources: true\n    toc: true\n    toc-depth: 4\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nstudy <- \"match\"\nversion <- \"v6\"\ny_col_name <- \"pp_hybrid_wk4_outcome\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\n# packages for script\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nlibrary(blme)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoading required package: lme4\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\nlibrary(lme4)\n\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/fun_eda.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"c045eee2655a18dc85e715b78182f176327358a7\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/chtc/static_files/fun_chtc.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"75cc6f7b855da59c240908bd936834b4da01285b\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\ntheme_set(theme_classic()) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| message: false\n#| warning: false\n\n# handle conflicts\noptions(conflicts.policy = \"depends.ok\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# absolute paths\nswitch (Sys.info()[['sysname']],\n        # PC paths\n        Windows = {\n          path_models <- str_c(\"P:/studydata/match/models/\", y_col_name)\n          path_data <- \"P:/studydata/match/processed_data\"},\n        \n        # IOS paths\n        Darwin = {\n          path_models <- str_c(\"/Volumes/private/studydata/match/models/\",\n                               y_col_name)\n          path_data <- \"/Volumes/private/studydata/match/processed_data\"},\n        \n        # Linux paths\n        Linux = {\n          path_models <- str_c(\"~/mnt/private/studydata/match/models/\",\n                               y_col_name)\n          path_data <- \"~/mnt/private/studydata/match/processed_data\"}\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# chunk defaults\n\noptions(tibble.width = Inf)\noptions(tibble.print_max = Inf)\n```\n:::\n\n\nRead in aim 2 dataset\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd <- read_csv(file.path(path_models, \n                        str_c(\"aim_2_\", version, \"_\", y_col_name, \".csv\")),\n              show_col_types = FALSE) |> \n  mutate(outcome_rct_wk4_num = if_else(outcome_rct_wk4 == \"abstinent\", 1, 0),\n         outcome_rct_wk12_num = if_else(outcome_rct_wk12 == \"abstinent\", 1, 0),\n         outcome_rct_wk26_num = if_else(outcome_rct_wk26 == \"abstinent\", 1, 0),\n         tx_worst = case_when(\n           prob_patch < prob_combo_nrt & prob_patch < prob_varenicline ~ \"patch\",\n           prob_combo_nrt < prob_patch & prob_combo_nrt < prob_varenicline ~ \"combo_nrt\",\n           prob_varenicline < prob_patch & prob_varenicline < prob_combo_nrt ~ \"varenicline\",\n           TRUE ~ NA_character_),\n         tx_second = case_when(\n           tx_worst == \"patch\" & tx_best == \"varenicline\" ~ \"combo_nrt\",\n           tx_worst == \"patch\" & tx_best == \"combo_nrt\" ~ \"varenicline\",\n           tx_worst == \"varenicline\" & tx_best == \"patch\" ~ \"combo_nrt\",\n           tx_worst == \"varenicline\" & tx_best == \"combo_nrt\" ~ \"patch\",\n           tx_worst == \"combo_nrt\" & tx_best == \"varenicline\" ~ \"patch\",\n           tx_worst == \"combo_nrt\" & tx_best == \"patch\" ~ \"varenicline\",\n           TRUE ~ NA_character_)) |> \n  mutate(tx_rank = case_when(\n    tx_rct == tx_best ~ \"first\",\n    tx_rct == tx_second ~ \"second\",\n    tx_rct == tx_worst ~ \"third\",\n    TRUE ~ NA_character_)) |> \n  select(subid, starts_with(\"tx_\"), starts_with(\"prob_\"),\n         outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num) |> \n  pivot_longer(\n    cols = c(outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num),\n    names_to = \"week\",\n    names_pattern = \"(?<=outcome_rct_wk)(.+)(?=_num)\",\n    values_to = \"outcome_rct_num\"\n  ) |> \n  mutate(c_tx_match = if_else(tx_match == TRUE, 0.5, -0.5), # center\n         week = as.numeric(week))\n\nglimpse(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,258\nColumns: 14\n$ subid            <dbl> 20010, 20010, 20010, 20015, 20015, 20015, 20030, 2003…\n$ tx_rct           <chr> \"patch\", \"patch\", \"patch\", \"combo_nrt\", \"combo_nrt\", …\n$ tx_best          <chr> \"varenicline\", \"varenicline\", \"varenicline\", \"varenic…\n$ tx_match         <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…\n$ tx_worst         <chr> \"combo_nrt\", \"combo_nrt\", \"combo_nrt\", \"patch\", \"patc…\n$ tx_second        <chr> \"patch\", \"patch\", \"patch\", \"combo_nrt\", \"combo_nrt\", …\n$ tx_rank          <chr> \"second\", \"second\", \"second\", \"second\", \"second\", \"se…\n$ prob_best        <dbl> 0.2799119, 0.2799119, 0.2799119, 0.5102584, 0.5102584…\n$ prob_patch       <dbl> 0.2080906, 0.2080906, 0.2080906, 0.4220443, 0.4220443…\n$ prob_combo_nrt   <dbl> 0.1754414, 0.1754414, 0.1754414, 0.4957828, 0.4957828…\n$ prob_varenicline <dbl> 0.2799119, 0.2799119, 0.2799119, 0.5102584, 0.5102584…\n$ week             <dbl> 4, 12, 26, 4, 12, 26, 4, 12, 26, 4, 12, 26, 4, 12, 26…\n$ outcome_rct_num  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,…\n$ c_tx_match       <dbl> -0.5, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5,…\n```\n\n\n:::\n:::\n\n\nRead in start-medication data and join\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_med <- read_csv(file.path(path_data, \"match_used_meds_cln.csv\"),\n                  show_col_types = FALSE)\n\nglimpse(d_med)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,086\nColumns: 3\n$ subid         <dbl> 20010, 20015, 20030, 20049, 20051, 20072, 20077, 20086, …\n$ treatment     <chr> \"patch\", \"combo_nrt\", \"patch\", \"varenicline\", \"patch\", \"…\n$ used_any_meds <chr> \"started_meds\", \"started_meds\", \"no_meds\", \"started_meds…\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nd <- left_join(d, d_med, join_by(\"subid\", \"tx_rct\" == \"treatment\"))\n\nglimpse(d)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,258\nColumns: 15\n$ subid            <dbl> 20010, 20010, 20010, 20015, 20015, 20015, 20030, 2003…\n$ tx_rct           <chr> \"patch\", \"patch\", \"patch\", \"combo_nrt\", \"combo_nrt\", …\n$ tx_best          <chr> \"varenicline\", \"varenicline\", \"varenicline\", \"varenic…\n$ tx_match         <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…\n$ tx_worst         <chr> \"combo_nrt\", \"combo_nrt\", \"combo_nrt\", \"patch\", \"patc…\n$ tx_second        <chr> \"patch\", \"patch\", \"patch\", \"combo_nrt\", \"combo_nrt\", …\n$ tx_rank          <chr> \"second\", \"second\", \"second\", \"second\", \"second\", \"se…\n$ prob_best        <dbl> 0.2799119, 0.2799119, 0.2799119, 0.5102584, 0.5102584…\n$ prob_patch       <dbl> 0.2080906, 0.2080906, 0.2080906, 0.4220443, 0.4220443…\n$ prob_combo_nrt   <dbl> 0.1754414, 0.1754414, 0.1754414, 0.4957828, 0.4957828…\n$ prob_varenicline <dbl> 0.2799119, 0.2799119, 0.2799119, 0.5102584, 0.5102584…\n$ week             <dbl> 4, 12, 26, 4, 12, 26, 4, 12, 26, 4, 12, 26, 4, 12, 26…\n$ outcome_rct_num  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0,…\n$ c_tx_match       <dbl> -0.5, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5, -0.5,…\n$ used_any_meds    <chr> \"started_meds\", \"started_meds\", \"started_meds\", \"star…\n```\n\n\n:::\n:::\n\n\n## Analyses\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_wk4 <- d |> \n  filter(week == 4)\n\nd_wk12 <- d |> \n  filter(week == 12)\n\nd_wk26 <- d |> \n  filter(week == 26)\n```\n:::\n\n\n\n### Primary\n\n4 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_4wk <- glm(outcome_rct_num ~ c_tx_match, \n                 data = d_wk4,\n                 family = binomial(link = \"logit\"))\n\nsummary(model_4wk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ c_tx_match, family = binomial(link = \"logit\"), \n    data = d_wk4)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -0.61446    0.06601  -9.308   <2e-16 ***\nc_tx_match   0.32376    0.13202   2.452   0.0142 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1394.7  on 1085  degrees of freedom\nResidual deviance: 1388.7  on 1084  degrees of freedom\nAIC: 1392.7\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n12 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_12wk <- glm(outcome_rct_num ~ c_tx_match, \n                  data = d_wk12,\n                  family = binomial(link = \"logit\"))\n\nsummary(model_12wk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ c_tx_match, family = binomial(link = \"logit\"), \n    data = d_wk12)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -0.87330    0.06908 -12.642   <2e-16 ***\nc_tx_match   0.16522    0.13816   1.196    0.232    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1308.0  on 1085  degrees of freedom\nResidual deviance: 1306.6  on 1084  degrees of freedom\nAIC: 1310.6\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n26 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_26wk <- glm(outcome_rct_num ~ c_tx_match, \n                  data = d_wk26,\n                  family = binomial(link = \"logit\"))\n\nsummary(model_26wk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ c_tx_match, family = binomial(link = \"logit\"), \n    data = d_wk26)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.11736    0.07337 -15.229   <2e-16 ***\nc_tx_match  -0.01054    0.14674  -0.072    0.943    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1213.6  on 1085  degrees of freedom\nResidual deviance: 1213.6  on 1084  degrees of freedom\nAIC: 1217.6\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n### Supplemental analyses: Started medication subset\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd_meds_only <- d |> \n  filter(used_any_meds == \"started_meds\")\n\ndim(d_meds_only)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2964   15\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nd_meds_wk4 <- d_meds_only |> \n  filter(week == 4)\n\nd_meds_wk12 <- d_meds_only |> \n  filter(week == 12)\n\nd_meds_wk26 <- d_meds_only |> \n  filter(week == 26)\n```\n:::\n\n\n4 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_4wk_meds <- glm(outcome_rct_num ~ c_tx_match, \n                      data = d_meds_wk4,\n                      family = binomial(link = \"logit\"))\n\nsummary(model_4wk_meds)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ c_tx_match, family = binomial(link = \"logit\"), \n    data = d_meds_wk4)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -0.48304    0.06788  -7.116 1.11e-12 ***\nc_tx_match   0.30643    0.13576   2.257    0.024 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1304.7  on 987  degrees of freedom\nResidual deviance: 1299.6  on 986  degrees of freedom\nAIC: 1303.6\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\nStill significant, slightly smaller estimate\n\n12 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_12wk_meds <- glm(outcome_rct_num ~ c_tx_match, \n                       data = d_meds_wk12,\n                       family = binomial(link = \"logit\"))\n\nsummary(model_12wk_meds)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ c_tx_match, family = binomial(link = \"logit\"), \n    data = d_meds_wk12)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -0.75888    0.07068 -10.737   <2e-16 ***\nc_tx_match   0.14806    0.14136   1.047    0.295    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1230.8  on 987  degrees of freedom\nResidual deviance: 1229.7  on 986  degrees of freedom\nAIC: 1233.7\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\nStill non-significant\n\n26 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_26wk_meds <- glm(outcome_rct_num ~ c_tx_match, \n                       data = d_meds_wk26,\n                       family = binomial(link = \"logit\"))\n\nsummary(model_26wk_meds)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ c_tx_match, family = binomial(link = \"logit\"), \n    data = d_meds_wk26)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.00618    0.07465 -13.478   <2e-16 ***\nc_tx_match  -0.01841    0.14930  -0.123    0.902    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1149  on 987  degrees of freedom\nResidual deviance: 1149  on 986  degrees of freedom\nAIC: 1153\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\nStill non-significant\n\n### Supplemental analyses: Treatment rank\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nd <- d |> \n  mutate(tx_rank_1v23 = case_match(tx_rank,\n                                   \"first\" ~ 2/3,\n                                   c(\"second\", \"third\") ~ -1/3),\n         tx_rank_2v3 = case_match(tx_rank, \n                                  \"first\" ~ 0,\n                                  \"third\" ~ -.5,\n                                  \"second\" ~ .5))\n\nd_wk4 <- d |> \n  filter(week == 4)\n\nd_wk12 <- d |> \n  filter(week == 12)\n\nd_wk26 <- d |> \n  filter(week == 26)\n```\n:::\n\n\n4 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_4wk_rank <- glm(outcome_rct_num ~ tx_rank_1v23 + tx_rank_2v3, \n                 data = d_wk4,\n                 family = binomial(link = \"logit\"))\n\nsummary(model_4wk_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ tx_rank_1v23 + tx_rank_2v3, family = binomial(link = \"logit\"), \n    data = d_wk4)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  -0.66820    0.06450 -10.360   <2e-16 ***\ntx_rank_1v23  0.32342    0.13203   2.450   0.0143 *  \ntx_rank_2v3   0.03144    0.16334   0.192   0.8474    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1394.7  on 1085  degrees of freedom\nResidual deviance: 1388.6  on 1083  degrees of freedom\nAIC: 1394.6\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n12 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_12wk_rank <- glm(outcome_rct_num ~ tx_rank_1v23 + tx_rank_2v3, \n                  data = d_wk12,\n                  family = binomial(link = \"logit\"))\n\nsummary(model_12wk_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ tx_rank_1v23 + tx_rank_2v3, family = binomial(link = \"logit\"), \n    data = d_wk12)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  -0.90187    0.06723 -13.415   <2e-16 ***\ntx_rank_1v23  0.16678    0.13822   1.207    0.228    \ntx_rank_2v3  -0.09021    0.16959  -0.532    0.595    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1308.0  on 1085  degrees of freedom\nResidual deviance: 1306.3  on 1083  degrees of freedom\nAIC: 1312.3\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n26 weeks\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmodel_26wk_rank <- glm(outcome_rct_num ~ tx_rank_1v23 + tx_rank_2v3, \n                  data = d_wk12,\n                  family = binomial(link = \"logit\"))\n\nsummary(model_26wk_rank)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = outcome_rct_num ~ tx_rank_1v23 + tx_rank_2v3, family = binomial(link = \"logit\"), \n    data = d_wk12)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  -0.90187    0.06723 -13.415   <2e-16 ***\ntx_rank_1v23  0.16678    0.13822   1.207    0.228    \ntx_rank_2v3  -0.09021    0.16959  -0.532    0.595    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1308.0  on 1085  degrees of freedom\nResidual deviance: 1306.3  on 1083  degrees of freedom\nAIC: 1312.3\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n:::\n\n\n## Figures\n\nPrimary figure\n\n::: {#cell-fig-clin-ben-wk4 .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-clin-ben-wk4\n#| fig-cap: \"Benefit of treatment matching. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.\"\n\nfig_clin_ben_wk4 <- d |> \n  mutate(week_cat = factor(week,\n                           levels = c(4, 12, 26),\n                           labels = c(\"Week 4\", \"Week 12\", \"Week 26\")),\n         tx_match = factor(tx_match, \n                           levels = c(TRUE, FALSE),\n                           labels = c(\"Best Treatment\", \"Other Treatment\"))) |> \n  group_by(week_cat, tx_match) |> \n  summarize(mean_outcome = mean(outcome_rct_num),\n            sd_outcome = sd(outcome_rct_num),\n            n_group = n()) |> \n  mutate(se_outcome = (sd_outcome / sqrt(n_group))) |> \n  ggplot(aes(x = week_cat, y = mean_outcome, fill = tx_match)) +\n  geom_col(position = \"dodge\") +\n  geom_errorbar(aes(ymin = mean_outcome - se_outcome, \n                    ymax = mean_outcome + se_outcome,\n                    x = week_cat),\n                position = position_dodge(width = 0.9),\n                width = 0.5) +\n  scale_y_continuous(limits = c(0, 0.45)) +\n  labs(\n    x = \"Week On-Study\",\n    y = \"Mean Abstinence Rate\",\n    fill = \"Treatment Matching\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'week_cat'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: fig-clin-ben-wk4\n#| fig-cap: \"Benefit of treatment matching. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.\"\n\nfig_clin_ben_wk4\n```\n\n::: {.cell-output-display}\n![Benefit of treatment matching. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.](eval_benefit_4wk_files/figure-html/fig-clin-ben-wk4-1.png){#fig-clin-ben-wk4 width=672}\n:::\n:::\n\n\nPrimary figure (replicated for supplement)\n\n::: {#cell-fig-clin-ben-wk4-supp .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-clin-ben-wk4-supp\n#| fig-cap: \"(Supplemental; reproduced from main text) Benefit of treatment matching from 4-week prediction model. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.\"\n\nfig_clin_ben_wk4_supp <- d |> \n  mutate(week_cat = factor(week,\n                           levels = c(4, 12, 26),\n                           labels = c(\"Week 4\", \"Week 12\", \"Week 26\")),\n         tx_match = factor(tx_match, \n                           levels = c(TRUE, FALSE),\n                           labels = c(\"Best Treatment\", \"Other Treatment\"))) |> \n  group_by(week_cat, tx_match) |> \n  summarize(mean_outcome = mean(outcome_rct_num),\n            sd_outcome = sd(outcome_rct_num),\n            n_group = n()) |> \n  mutate(se_outcome = (sd_outcome / sqrt(n_group))) |> \n  ggplot(aes(x = week_cat, y = mean_outcome, fill = tx_match)) +\n  geom_col(position = \"dodge\") +\n  geom_errorbar(aes(ymin = mean_outcome - se_outcome, \n                    ymax = mean_outcome + se_outcome,\n                    x = week_cat),\n                position = position_dodge(width = 0.9),\n                width = 0.5) +\n  scale_y_continuous(limits = c(0, 0.45)) +\n  labs(\n    x = \"Week On-Study\",\n    y = \"Mean Abstinence Rate\",\n    fill = \"Treatment Matching\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'week_cat'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: fig-clin-ben-wk4-supp\n#| fig-cap: \"(Supplemental; reproduced from main text) Benefit of treatment matching from 4-week prediction model. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.\"\n\nfig_clin_ben_wk4_supp\n```\n\n::: {.cell-output-display}\n![(Supplemental; reproduced from main text) Benefit of treatment matching from 4-week prediction model. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.](eval_benefit_4wk_files/figure-html/fig-clin-ben-wk4-supp-1.png){#fig-clin-ben-wk4-supp width=672}\n:::\n:::\n\n\nSupplemental figure: Started medication subset\n\n::: {#cell-fig-med-subset-wk4-supp .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-med-subset-wk4-supp\n#| fig-cap: \"Benefit of treatment matching among individuals who reported any medication use over the first 4 weeks. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.\"\n\nfig_med_subset_wk4_supp <- d_meds_only |> \n  mutate(week_cat = factor(week,\n                           levels = c(4, 12, 26),\n                           labels = c(\"Week 4\", \"Week 12\", \"Week 26\")),\n         tx_match = factor(tx_match, \n                           levels = c(TRUE, FALSE),\n                           labels = c(\"Best Treatment\", \"Other Treatment\"))) |> \n  group_by(week_cat, tx_match) |> \n  summarize(mean_outcome = mean(outcome_rct_num),\n            sd_outcome = sd(outcome_rct_num),\n            n_group = n()) |> \n  mutate(se_outcome = (sd_outcome / sqrt(n_group))) |> \n  ggplot(aes(x = week_cat, y = mean_outcome, fill = tx_match)) +\n  geom_col(position = \"dodge\") +\n  geom_errorbar(aes(ymin = mean_outcome - se_outcome, \n                    ymax = mean_outcome + se_outcome,\n                    x = week_cat),\n                position = position_dodge(width = 0.9),\n                width = 0.5) +\n  scale_y_continuous(limits = c(0, 0.45)) +\n  labs(\n    x = \"Week On-Study\",\n    y = \"Mean Abstinence Rate\",\n    fill = \"Treatment Matching\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'week_cat'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: fig-med-subset-wk4-supp\n#| fig-cap: \"Benefit of treatment matching among individuals who reported any medication use over the first 4 weeks. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.\"\n\nfig_med_subset_wk4_supp\n```\n\n::: {.cell-output-display}\n![Benefit of treatment matching among individuals who reported any medication use over the first 4 weeks. Bars represent mean observed abstinence (from original trial) for individuals who did and did not receive their model-predicted best treatment, over time. Error bars indicate standard errors.](eval_benefit_4wk_files/figure-html/fig-med-subset-wk4-supp-1.png){#fig-med-subset-wk4-supp width=672}\n:::\n:::\n\n\nSupplemental figure: Treatment rank\n\n::: {#cell-fig-rank-wk4-supp .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-rank-wk4-supp\n#| fig-cap: \"Benefit of treatment matching using treatment rank. Bars represent mean observed abstinence (from original trial) for individuals who received their model-predicted best, second-best, or worst treatment, over time. Error bars indicate standard errors.\"\n\nfig_rank_wk4_supp <- d |> \n  mutate(week_cat = factor(week,\n                           levels = c(4, 12, 26),\n                           labels = c(\"Week 4\", \"Week 12\", \"Week 26\")),\n         tx_rank = factor(tx_rank, \n                           levels = c(\"first\", \"second\", \"third\"),\n                           labels = c(\"Best Treatment\", \"Second-best Treatment\",\n                                      \"Worst Treatment\"))) |> \n  group_by(week_cat, tx_rank) |> \n  summarize(mean_outcome = mean(outcome_rct_num),\n            sd_outcome = sd(outcome_rct_num),\n            n_group = n()) |> \n  mutate(se_outcome = (sd_outcome / sqrt(n_group))) |> \n  ggplot(aes(x = week_cat, y = mean_outcome, fill = tx_rank)) +\n  geom_col(position = \"dodge\") +\n  geom_errorbar(aes(ymin = mean_outcome - se_outcome, \n                    ymax = mean_outcome + se_outcome,\n                    x = week_cat),\n                position = position_dodge(width = 0.9),\n                width = 0.5) +\n  scale_y_continuous(limits = c(0, 0.45)) +\n  labs(\n    x = \"Week On-Study\",\n    y = \"Mean Abstinence Rate\",\n    fill = \"Treatment Rank\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'week_cat'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: fig-rank-wk4-supp\n#| fig-cap: \"Benefit of treatment matching using treatment rank. Bars represent mean observed abstinence (from original trial) for individuals who received their model-predicted best, second-best, or worst treatment, over time. Error bars indicate standard errors.\"\n\nfig_rank_wk4_supp\n```\n\n::: {.cell-output-display}\n![Benefit of treatment matching using treatment rank. Bars represent mean observed abstinence (from original trial) for individuals who received their model-predicted best, second-best, or worst treatment, over time. Error bars indicate standard errors.](eval_benefit_4wk_files/figure-html/fig-rank-wk4-supp-1.png){#fig-rank-wk4-supp width=672}\n:::\n:::\n",
    "supporting": [
      "eval_benefit_4wk_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}