{
  "hash": "1272c14705fb6853da4c02f3b5d95840",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Figure 1\nauthor: John Curtin\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# set up environment\noptions(conflicts.policy = \"depends.ok\")\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ntheme_set(theme_classic()) \n\n# Paths\n# not needed for this demo but included as example for lab scripts\ndevtools::source_url(\"https://github.com/jjcurtin/lab_support/blob/main/format_path.R?raw=true\")\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ SHA-1 hash of file is \"a58e57da996d1b70bb9a5b58241325d6fd78890f\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\npath_models <- format_path(\"studydata/match/models/pp_hybrid_wk4_outcome\")\n```\n:::\n\n\nOpen aim 2 analysis data\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nversion <- \"v5\"\nd <- read_csv(here::here(path_models, str_c(\"aim_2_\", version, \".csv\")),\n              show_col_types = FALSE) |> \n  mutate(outcome_rct_wk4_num = if_else(outcome_rct_wk4 == \"abstinent\", 1, 0),\n         outcome_rct_wk12_num = if_else(outcome_rct_wk12 == \"abstinent\", 1, 0),\n         outcome_rct_wk26_num = if_else(outcome_rct_wk26 == \"abstinent\", 1, 0),\n         tx_worst = case_when(\n           prob_patch < prob_combo_nrt & prob_patch < prob_varenicline ~ \"patch\",\n           prob_combo_nrt < prob_patch & prob_combo_nrt < prob_varenicline ~ \"combo_nrt\",\n           prob_varenicline < prob_patch & prob_varenicline < prob_combo_nrt ~ \"varenicline\",\n           TRUE ~ NA_character_),\n         tx_second = case_when(\n           tx_worst == \"patch\" & tx_best == \"varenicline\" ~ \"combo_nrt\",\n           tx_worst == \"patch\" & tx_best == \"combo_nrt\" ~ \"varenicline\",\n           tx_worst == \"varenicline\" & tx_best == \"patch\" ~ \"combo_nrt\",\n           tx_worst == \"varenicline\" & tx_best == \"combo_nrt\" ~ \"patch\",\n           tx_worst == \"combo_nrt\" & tx_best == \"varenicline\" ~ \"patch\",\n           tx_worst == \"combo_nrt\" & tx_best == \"patch\" ~ \"varenicline\",\n           TRUE ~ NA_character_)) |> \n  mutate(tx_rank = case_when(\n    tx_rct == tx_best ~ \"first\",\n    tx_rct == tx_second ~ \"second\",\n    tx_rct == tx_worst ~ \"third\",\n    TRUE ~ NA_character_)) |> \n  select(subid, starts_with(\"tx_\"), starts_with(\"prob_\"),\n         outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num) \n```\n:::\n\n\nFormat data for figure\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# make figure for john's presentation\nd_fig <- d |> \n  select(subid, tx_rank, \n         outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num) |> \n  pivot_longer(\n    cols = c(outcome_rct_wk4_num, outcome_rct_wk12_num, outcome_rct_wk26_num),\n    names_to = \"week\",\n    names_pattern = \"(?<=outcome_rct_)(.+)(?=_num)\",\n    values_to = \"outcome_rct_num\"\n  ) |> \n  mutate(tx_rank = factor(tx_rank, \n                          levels = c(\"first\", \"second\", \"third\")),\n         week = factor(week,\n                       levels = c(\"wk4\", \"wk12\", \"wk26\")),\n         subid = factor(subid)) |> \n  summarize(outcome_mean = mean(outcome_rct_num), .by = c(tx_rank, week)) \n```\n:::\n\n\nMake bar chart version\n\n\n::: {#cell-fig-bar .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-bar\n#| fig-cap: \"Abstince Rate over Time by Tx Rank\"\n\nd_fig |> \n  ggplot(aes(x = week, y = outcome_mean, fill = tx_rank)) +\n  geom_col(position = \"dodge\") \n```\n\n::: {.cell-output-display}\n![Abstince Rate over Time by Tx Rank](fig1_files/figure-html/fig-bar-1.png){#fig-bar width=672}\n:::\n:::\n\n\nMake line chart version\n\n::: {#cell-fig-line .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-line\n#| fig-cap: \"Abstince Rate over Time by Tx Rank\"\n\nd_fig |> \n  ggplot(aes(x = week, y = outcome_mean, color = tx_rank)) +\n  geom_line(aes(group = tx_rank)) +\n  geom_point() +\n  scale_y_continuous(limits = c(0, 0.5))\n```\n\n::: {.cell-output-display}\n![Abstince Rate over Time by Tx Rank](fig1_files/figure-html/fig-line-1.png){#fig-line width=672}\n:::\n:::",
    "supporting": [
      "fig1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}